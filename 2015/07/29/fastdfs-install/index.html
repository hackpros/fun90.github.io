<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="fun90&#39;s blog">
  <meta name="keyword" content="java, 软件, mac">
  <title>
    
      FastDFS安装笔记 | Fun90
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
</head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Fun90</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">归档</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">首页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">归档</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>FastDFS安装笔记</h2>
  <p class="post-date">2015-07-29</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body">
  <article class="post-article">
    <section class="markdown-content"><h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><ol>
<li>系统版本为CentOS 7</li>
<li>fastdfs版本选用的5.05</li>
</ol>
<p>注意：系统版本不一样，相关命令会有差异</p>
<h2 id="下载准备"><a href="#下载准备" class="headerlink" title="下载准备"></a>下载准备</h2><p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-1.png" alt=""><br><a id="more"></a><br>选用fastdfsz的版本是5.05，区别于以往版本，这个版本将公共的一些函数等单独封装成了libfastcommon这个jar包，所以在安装fastdfs之前，我们必须先安装libfastcommon。</p>
<h2 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /opt</div><div class="line">wget https://github.com/happyfish100/libfastcommon/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line"><span class="built_in">cd</span> libfastcommon-master</div><div class="line">./make.sh</div><div class="line">./make.sh install</div></pre></td></tr></table></figure>
<p>缺少依赖包，出现如下错误：<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-2.png" alt=""></p>
<p>安装依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install gcc perl</div></pre></td></tr></table></figure></p>
<p>再次安装libcofastcommon<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/opt/libfastcommon-master &amp;&amp; ./make.sh &amp;&amp; ./make.sh install</div></pre></td></tr></table></figure></p>
<h2 id="安装fastdfs"><a href="#安装fastdfs" class="headerlink" title="安装fastdfs"></a>安装fastdfs</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget  https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</div><div class="line">tar -zxvf V5.05.tar.gz </div><div class="line"><span class="built_in">cd</span> fastdfs-5.05/</div><div class="line">./make.sh</div><div class="line">./make.sh install</div></pre></td></tr></table></figure>
<p>安装完成后，所有可执行文件在目录/usr/bin下，以fdfs_开头：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ls /usr/bin/fdfs_*</div><div class="line">/usr/bin/fdfs_appender_test   /usr/bin/fdfs_monitor</div><div class="line">/usr/bin/fdfs_appender_test1  /usr/bin/fdfs_storaged</div><div class="line">/usr/bin/fdfs_append_file     /usr/bin/fdfs_test</div><div class="line">/usr/bin/fdfs_crc32           /usr/bin/fdfs_test1</div><div class="line">/usr/bin/fdfs_delete_file     /usr/bin/fdfs_trackerd</div><div class="line">/usr/bin/fdfs_download_file   /usr/bin/fdfs_upload_appender</div><div class="line">/usr/bin/fdfs_file_info       /usr/bin/fdfs_upload_file</div></pre></td></tr></table></figure></p>
<p>配置文件在目录/etc/fdfs下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls /etc/fdfs</div><div class="line">client.conf.sample  storage.conf.sample  tracker.conf.sample</div></pre></td></tr></table></figure></p>
<h2 id="配置Tracker跟踪器"><a href="#配置Tracker跟踪器" class="headerlink" title="配置Tracker跟踪器"></a>配置Tracker跟踪器</h2><p>开放tracker监听端口访问<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=22122/tcp --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>修改Tracker配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp tracker.conf.sample tracker.conf</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> tracker.conf</div></pre></td></tr></table></figure></p>
<p>设置Tracker便捷管理命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">bash -c <span class="string">'cat &gt; /usr/lib/systemd/system/fdfs_trackerd.service &lt;&lt; EOF</span></div><div class="line">[Unit]</div><div class="line">Description=fastdfs tracker server</div><div class="line">After=network.target</div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/home/fastdfs/data/fdfs_trackerd.pid</div><div class="line">ExecStart=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf</div><div class="line">ExecReload=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart</div><div class="line">ExecStop=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop</div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF'</div><div class="line">systemctl <span class="built_in">enable</span> fdfs_trackerd.service</div></pre></td></tr></table></figure></p>
<p>启动tracker<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start fdfs_trackerd.service</div></pre></td></tr></table></figure></p>
<p>查看启动tracker日志，确认tracker是否启动成功<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /home/fastdfs/logs/trackerd.log</div></pre></td></tr></table></figure></p>
<h2 id="配置Storage存储节点"><a href="#配置Storage存储节点" class="headerlink" title="配置Storage存储节点"></a>配置Storage存储节点</h2><p>开放Storage监听端口访问<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=23000/tcp --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>修改Storage配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp storage.conf.sample storage.conf</div><div class="line">cp /opt/fastdfs-5.05/conf/http.conf .</div><div class="line">cp /opt/fastdfs-5.05/conf/mime.types .</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> storage.conf</div><div class="line">sed -i <span class="string">'s:store_path0=.*:store_path0=/home/fastdfs:g'</span> storage.conf</div><div class="line">sed -i <span class="string">'s/tracker_server=.*/tracker_server=192.168.0.80:22122/g'</span> storage.conf</div></pre></td></tr></table></figure></p>
<p>设置Storage便捷管理命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">bash -c <span class="string">'cat &gt; /usr/lib/systemd/system/fdfs_storaged.service &lt;&lt; EOF</span></div><div class="line">[Unit]</div><div class="line">Description=fastdfs storage server</div><div class="line">After=network.target</div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/home/fastdfs/data/fdfs_storaged.pid</div><div class="line">ExecStart=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf</div><div class="line">ExecReload=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</div><div class="line">ExecStop=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop</div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF'</div><div class="line">systemctl <span class="built_in">enable</span> fdfs_storaged.service</div></pre></td></tr></table></figure></p>
<p>启动Storage<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start fdfs_storaged.service</div></pre></td></tr></table></figure></p>
<p>查看启动Storage日志，确认Storage是否启动成功<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /home/fastdfs/logs/storaged.log</div></pre></td></tr></table></figure></p>
<h2 id="配置Client客户端"><a href="#配置Client客户端" class="headerlink" title="配置Client客户端"></a>配置Client客户端</h2><p>这里搭建的是测试环境，所以Client与Tracker、Storage都安装在同一台机器上<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp client.conf.sample client.conf</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> client.conf</div><div class="line">sed -i <span class="string">'s/tracker_server=.*/tracker_server=192.168.0.80:22122/g'</span> client.conf</div></pre></td></tr></table></figure></p>
<h2 id="FastDFS测试"><a href="#FastDFS测试" class="headerlink" title="FastDFS测试"></a>FastDFS测试</h2><p>上传测试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_upload_file /etc/fdfs/client.conf /opt/Tulips.jpg</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-3.png" alt=""></p>
<p>查看文件信息<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_file_info /etc/fdfs/client.conf group1/M00/00/00/wKgAUFXByOmAVJ5kAABzaUPC-FA256.jpg</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-4.png" alt=""><br>下载测试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_download_file /etc/fdfs/client.conf group1/M00/00/00/wKgAUFXByOmAVJ5kAABzaUPC-FA256.jpg downtest.jpg</div></pre></td></tr></table></figure></p>
<p>重启命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_trackerd  /etc/fdfs/tracker.conf  restart</div><div class="line">/usr/bin/fdfs_storaged  /etc/fdfs/storage.conf  restart</div></pre></td></tr></table></figure></p>
<h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><p>安装缺少的依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install gcc-c++ </div><div class="line">yum install pcre pcre-devel </div><div class="line">yum install zlib zlib-devel </div><div class="line">yum install openssl openssl--devel</div></pre></td></tr></table></figure></p>
<p>解压nginx-1.7.12.tar.gz，编译安装Nginx<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">tar -zxvf nginx-1.7.12.tar.gz</div><div class="line"><span class="built_in">cd</span> /opt/nginx-1.7.12</div><div class="line">./configure --prefix=/opt/nginx --user=nginx --group=nginx --with-pcre --with-debug --add-module=/opt/fastdfs-nginx-module-master/src</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>安装完最后会列出配置信息<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Configuration summary</div><div class="line">  + using PCRE library: /usr/lib64</div><div class="line">  + OpenSSL library is not used</div><div class="line">  + using <span class="built_in">builtin</span> md5 code</div><div class="line">  + sha1 library is not found</div><div class="line">  + using zlib library: /usr/lib64</div><div class="line">  nginx path prefix: <span class="string">"/opt/nginx"</span></div><div class="line">  nginx binary file: <span class="string">"/opt/nginx/sbin/nginx"</span></div><div class="line">  nginx configuration prefix: <span class="string">"/opt/nginx/conf"</span></div><div class="line">  nginx configuration file: <span class="string">"/opt/nginx/conf/nginx.conf"</span></div><div class="line">  nginx pid file: <span class="string">"/opt/nginx/logs/nginx.pid"</span></div><div class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/opt/nginx/logs/error.log"</span></div><div class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/opt/nginx/logs/access.log"</span></div><div class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></div><div class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></div><div class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></div><div class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></div><div class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></div></pre></td></tr></table></figure></p>
<p>防火墙开发HTTP服务<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --zone=public --add-service=http</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>创建nginx用户<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd nginx</div><div class="line">passwd</div></pre></td></tr></table></figure></p>
<p>启动nginx<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/nginx/sbin/nginx</div></pre></td></tr></table></figure></p>
<p>查看端口<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -tnlp|grep nginx</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-6.png" alt=""></p>
<p>浏览器访问<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-7.png" alt=""></p>
<p>其他命令<br>Nginx -s stop         快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。（quick exit）<br>Nginx -s quit         平稳关闭Nginx，保存相关信息，有安排的结束web服务。（graceful exit）<br>Nginx -s reload       因改变了Nginx相关配置，需要重新加载配置而重载。（changing configuration，start a new worker,quitting an old worker gracefully.)<br>Nginx -s reopen       重新打开日志文件。(reopenging log files)</p>
<h2 id="fastdfs-nginx-module-配置"><a href="#fastdfs-nginx-module-配置" class="headerlink" title="fastdfs-nginx-module 配置"></a>fastdfs-nginx-module 配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp /opt/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/</div><div class="line">touch /home/fastdfs/logs/mod_fastdfs.log</div><div class="line">chown nginx:nginx /home/fastdfs/logs/mod_fastdfs.log</div><div class="line">vi /etc/fdfs/mod_fastdfs.conf</div></pre></td></tr></table></figure>
<p>修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">base_path=/home/fastdfs</div><div class="line">tracker_server=192.168.0.80:22122</div><div class="line">store_path0=/home/fastdfs</div><div class="line">log_filename=/home/fastdfs/logs/mod_fastdfs.log</div></pre></td></tr></table></figure></p>
<p>##<br>Storage服务器Nginx配置<br>/usr/local/nginx/conf/nginx.conf 上server{} 里添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">location ~/group1/M00 &#123;</div><div class="line">    alias /home/fastdfs/data;</div><div class="line">    ngx_fastdfs_module;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Nginx重新加载配置<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/nginx/sbin/nginx <span class="_">-s</span> reload</div></pre></td></tr></table></figure></p>
<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><p>1、当上传文件时发现总是失败返回response status 2 !=0，查看storaged.log发现如下错误：<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-5.png" alt=""><br>用fdfs_monitor命令查看storage节点状态<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</div></pre></td></tr></table></figure></p>
<p>发现两个离线状态的无效storage节点，用以下命令删除之<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fdfs_monitor /etc/fdfs/client.conf delete group1 192.168.0.80</div></pre></td></tr></table></figure></p>
<p>重启tracker及storage服务，问题解决。<br>未深入分析原因。</p>
<p>2、访问图片出现400错误<br>查看日志/home/fastdfs/logs/mod_fastdfs.log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[2015-07-30 16:24:13] ERROR - file: ../common/fdfs_global.c, line: 52, the format of filename &quot;group1/M00/00/00/wKgAUFW53n-AZ5X2AABzaUPC-FA370.jpg&quot; is invalid</div></pre></td></tr></table></figure></p>
<p>/opt/nginx/logs/error.log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">192.168.0.170 - - [30/Jul/2015:16:13:06 +0800] &quot;GET /group1/M00/00/00/wKgAUFW5w4iAViuiAABVNkmGVeE577.xml HTTP/1.1&quot; 400 575 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36&quot;</div></pre></td></tr></table></figure></p>
<p>后查明是因为url中带了group名字，FastDFS是默认关闭的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url_have_group_name=false</div></pre></td></tr></table></figure></p>
<p>将以上参数改为true即可<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'s:url_have_group_name.*:url_have_group_name=true:g'</span> /etc/fdfs/mod_fastdfs.conf</div></pre></td></tr></table></figure></p>
</section>
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#FastDFS" >
    <span class="tag-code">FastDFS</span>
  </a>

      </div>
    
    <div class="money-like">
      <div class="reward-btn">
        赏
        <span class="money-code">
          <span class="alipay-code">
            <div class="code-image"></div>
            <b>使用支付宝打赏</b>
          </span>
          <span class="wechat-code">
            <div class="code-image"></div>
            <b>使用微信打赏</b>
          </span>
        </span>
      </div>
      <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
    </div>
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice">扫描二维码，分享此文章</p>
    </div>
    
      <div id="comments"></div>
    
  </article>
</main>

<script>
  (function () {
    var url = 'http://fun90.github.io/2015/07/29/fastdfs-install/';
    $('#article-banner').geopattern(url)
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png') 
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      var imageW = $(this).width()
      var imageH = $(this).height()
      
      var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
      zoom = zoom < 1 ? 1 : zoom
      zoom = zoom > 2 ? 2 : zoom
      var transY = (($(window).height() - imageH) / 2).toFixed(2)

      $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
      $('.image-view-wrap').addClass('wrap-active')
      $('.image-view-wrap img').css({
        'width': `${imageW}`,
        'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
      })
      $('html').css('overflow', 'hidden')

      $('.image-view-wrap').on('click', function() {
        $(this).remove()
        $('html').attr('style', '')
      })
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "fun90";
    if (gitmentConfig != "undefined") {
      var gitment = new Gitment({
        id: "FastDFS安装笔记",
        owner: "fun90",
        repo: "fun90.github.io",
        oauth: {
          client_id: "3a5391174396dbac6d14",
          client_secret: "f9d2cf3b9daa6ae81e27ed9bc4ae36e1fb3c10f7"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2017 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine == 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>