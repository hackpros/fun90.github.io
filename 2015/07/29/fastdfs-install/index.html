<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="keyword" content="Java, Mac, 软件, 效率">
  <meta name="author" content="Fun90">
  <!-- Open Graph Data -->
  <meta property="og:title" content="FastDFS安装笔记"/>
  <meta property="og:description" content="记录学习、开发、软件分享的地方，Java, Mac, 软件, 效率" />
  <meta property="og:site_name" content="Fun90"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://fun90.github.ioundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="Fun90" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  

  <!-- Site Title -->
  <title>Fun90</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  


</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">FastDFS安装笔记</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  首页
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  归档
                  
                </a>
              </li>
            
              <li>
                <a href="/tags">
                  
                  标签
                  
                </a>
              </li>
            
              <li>
                <a href="/categories">
                  
                  分类
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/fun90">
                  
                  Github
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>



<aside class="post-widget">
    <nav class="post-toc-wrap" id="post-toc">
        <h4>TOC</h4>
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#版本说明"><span class="post-toc-number">1.</span> <span class="post-toc-text">版本说明</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#下载准备"><span class="post-toc-number">2.</span> <span class="post-toc-text">下载准备</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装libfastcommon"><span class="post-toc-number">3.</span> <span class="post-toc-text">安装libfastcommon</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装fastdfs"><span class="post-toc-number">4.</span> <span class="post-toc-text">安装fastdfs</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置tracker跟踪器"><span class="post-toc-number">5.</span> <span class="post-toc-text">配置Tracker跟踪器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置storage存储节点"><span class="post-toc-number">6.</span> <span class="post-toc-text">配置Storage存储节点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置client客户端"><span class="post-toc-number">7.</span> <span class="post-toc-text">配置Client客户端</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#fastdfs测试"><span class="post-toc-number">8.</span> <span class="post-toc-text">FastDFS测试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#nginx安装"><span class="post-toc-number">9.</span> <span class="post-toc-text">Nginx安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#fastdfs-nginx-module-配置"><span class="post-toc-number">10.</span> <span class="post-toc-text">fastdfs-nginx-module 配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#问题总结"><span class="post-toc-number">11.</span> <span class="post-toc-text">问题总结</span></a></li></ol>
    </nav>
</aside>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Fun90</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2015-07-29</span>
            <span class="time">00:21:27</span>
          </span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/FastDFS/">#FastDFS</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><ol>
<li>系统版本为CentOS 7</li>
<li>fastdfs版本选用的5.05</li>
</ol>
<p>注意：系统版本不一样，相关命令会有差异</p>
<h2 id="下载准备"><a href="#下载准备" class="headerlink" title="下载准备"></a>下载准备</h2><p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-1.png" alt=""><br><a id="more"></a><br>选用fastdfsz的版本是5.05，区别于以往版本，这个版本将公共的一些函数等单独封装成了libfastcommon这个jar包，所以在安装fastdfs之前，我们必须先安装libfastcommon。</p>
<h2 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /opt</div><div class="line">wget https://github.com/happyfish100/libfastcommon/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line"><span class="built_in">cd</span> libfastcommon-master</div><div class="line">./make.sh</div><div class="line">./make.sh install</div></pre></td></tr></table></figure>
<p>缺少依赖包，出现如下错误：<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-2.png" alt=""></p>
<p>安装依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install gcc perl</div></pre></td></tr></table></figure></p>
<p>再次安装libcofastcommon<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/opt/libfastcommon-master &amp;&amp; ./make.sh &amp;&amp; ./make.sh install</div></pre></td></tr></table></figure></p>
<h2 id="安装fastdfs"><a href="#安装fastdfs" class="headerlink" title="安装fastdfs"></a>安装fastdfs</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget  https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</div><div class="line">tar -zxvf V5.05.tar.gz </div><div class="line"><span class="built_in">cd</span> fastdfs-5.05/</div><div class="line">./make.sh</div><div class="line">./make.sh install</div></pre></td></tr></table></figure>
<p>安装完成后，所有可执行文件在目录/usr/bin下，以fdfs_开头：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ls /usr/bin/fdfs_*</div><div class="line">/usr/bin/fdfs_appender_test   /usr/bin/fdfs_monitor</div><div class="line">/usr/bin/fdfs_appender_test1  /usr/bin/fdfs_storaged</div><div class="line">/usr/bin/fdfs_append_file     /usr/bin/fdfs_test</div><div class="line">/usr/bin/fdfs_crc32           /usr/bin/fdfs_test1</div><div class="line">/usr/bin/fdfs_delete_file     /usr/bin/fdfs_trackerd</div><div class="line">/usr/bin/fdfs_download_file   /usr/bin/fdfs_upload_appender</div><div class="line">/usr/bin/fdfs_file_info       /usr/bin/fdfs_upload_file</div></pre></td></tr></table></figure></p>
<p>配置文件在目录/etc/fdfs下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls /etc/fdfs</div><div class="line">client.conf.sample  storage.conf.sample  tracker.conf.sample</div></pre></td></tr></table></figure></p>
<h2 id="配置tracker跟踪器"><a href="#配置Tracker跟踪器" class="headerlink" title="配置Tracker跟踪器"></a>配置Tracker跟踪器</h2><p>开放tracker监听端口访问<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=22122/tcp --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>修改Tracker配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp tracker.conf.sample tracker.conf</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> tracker.conf</div></pre></td></tr></table></figure></p>
<p>设置Tracker便捷管理命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">bash -c <span class="string">'cat &gt; /usr/lib/systemd/system/fdfs_trackerd.service &lt;&lt; EOF</span></div><div class="line">[Unit]</div><div class="line">Description=fastdfs tracker server</div><div class="line">After=network.target</div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/home/fastdfs/data/fdfs_trackerd.pid</div><div class="line">ExecStart=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf</div><div class="line">ExecReload=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart</div><div class="line">ExecStop=/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop</div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF'</div><div class="line">systemctl <span class="built_in">enable</span> fdfs_trackerd.service</div></pre></td></tr></table></figure></p>
<p>启动tracker<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start fdfs_trackerd.service</div></pre></td></tr></table></figure></p>
<p>查看启动tracker日志，确认tracker是否启动成功<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /home/fastdfs/logs/trackerd.log</div></pre></td></tr></table></figure></p>
<h2 id="配置storage存储节点"><a href="#配置Storage存储节点" class="headerlink" title="配置Storage存储节点"></a>配置Storage存储节点</h2><p>开放Storage监听端口访问<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=23000/tcp --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>修改Storage配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp storage.conf.sample storage.conf</div><div class="line">cp /opt/fastdfs-5.05/conf/http.conf .</div><div class="line">cp /opt/fastdfs-5.05/conf/mime.types .</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> storage.conf</div><div class="line">sed -i <span class="string">'s:store_path0=.*:store_path0=/home/fastdfs:g'</span> storage.conf</div><div class="line">sed -i <span class="string">'s/tracker_server=.*/tracker_server=192.168.0.80:22122/g'</span> storage.conf</div></pre></td></tr></table></figure></p>
<p>设置Storage便捷管理命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">bash -c <span class="string">'cat &gt; /usr/lib/systemd/system/fdfs_storaged.service &lt;&lt; EOF</span></div><div class="line">[Unit]</div><div class="line">Description=fastdfs storage server</div><div class="line">After=network.target</div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/home/fastdfs/data/fdfs_storaged.pid</div><div class="line">ExecStart=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf</div><div class="line">ExecReload=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</div><div class="line">ExecStop=/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop</div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF'</div><div class="line">systemctl <span class="built_in">enable</span> fdfs_storaged.service</div></pre></td></tr></table></figure></p>
<p>启动Storage<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start fdfs_storaged.service</div></pre></td></tr></table></figure></p>
<p>查看启动Storage日志，确认Storage是否启动成功<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /home/fastdfs/logs/storaged.log</div></pre></td></tr></table></figure></p>
<h2 id="配置client客户端"><a href="#配置Client客户端" class="headerlink" title="配置Client客户端"></a>配置Client客户端</h2><p>这里搭建的是测试环境，所以Client与Tracker、Storage都安装在同一台机器上<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/fastdfs</div><div class="line"><span class="built_in">cd</span> /etc/fdfs</div><div class="line">cp client.conf.sample client.conf</div><div class="line">sed -i <span class="string">'s:base_path=.*:base_path=/home/fastdfs:g'</span> client.conf</div><div class="line">sed -i <span class="string">'s/tracker_server=.*/tracker_server=192.168.0.80:22122/g'</span> client.conf</div></pre></td></tr></table></figure></p>
<h2 id="fastdfs测试"><a href="#FastDFS测试" class="headerlink" title="FastDFS测试"></a>FastDFS测试</h2><p>上传测试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_upload_file /etc/fdfs/client.conf /opt/Tulips.jpg</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-3.png" alt=""></p>
<p>查看文件信息<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_file_info /etc/fdfs/client.conf group1/M00/00/00/wKgAUFXByOmAVJ5kAABzaUPC-FA256.jpg</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-4.png" alt=""><br>下载测试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_download_file /etc/fdfs/client.conf group1/M00/00/00/wKgAUFXByOmAVJ5kAABzaUPC-FA256.jpg downtest.jpg</div></pre></td></tr></table></figure></p>
<p>重启命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_trackerd  /etc/fdfs/tracker.conf  restart</div><div class="line">/usr/bin/fdfs_storaged  /etc/fdfs/storage.conf  restart</div></pre></td></tr></table></figure></p>
<h2 id="nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><p>安装缺少的依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install gcc-c++ </div><div class="line">yum install pcre pcre-devel </div><div class="line">yum install zlib zlib-devel </div><div class="line">yum install openssl openssl--devel</div></pre></td></tr></table></figure></p>
<p>解压nginx-1.7.12.tar.gz，编译安装Nginx<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">tar -zxvf nginx-1.7.12.tar.gz</div><div class="line"><span class="built_in">cd</span> /opt/nginx-1.7.12</div><div class="line">./configure --prefix=/opt/nginx --user=nginx --group=nginx --with-pcre --with-debug --add-module=/opt/fastdfs-nginx-module-master/src</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>安装完最后会列出配置信息<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Configuration summary</div><div class="line">  + using PCRE library: /usr/lib64</div><div class="line">  + OpenSSL library is not used</div><div class="line">  + using <span class="built_in">builtin</span> md5 code</div><div class="line">  + sha1 library is not found</div><div class="line">  + using zlib library: /usr/lib64</div><div class="line">  nginx path prefix: <span class="string">"/opt/nginx"</span></div><div class="line">  nginx binary file: <span class="string">"/opt/nginx/sbin/nginx"</span></div><div class="line">  nginx configuration prefix: <span class="string">"/opt/nginx/conf"</span></div><div class="line">  nginx configuration file: <span class="string">"/opt/nginx/conf/nginx.conf"</span></div><div class="line">  nginx pid file: <span class="string">"/opt/nginx/logs/nginx.pid"</span></div><div class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/opt/nginx/logs/error.log"</span></div><div class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/opt/nginx/logs/access.log"</span></div><div class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></div><div class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></div><div class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></div><div class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></div><div class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></div></pre></td></tr></table></figure></p>
<p>防火墙开发HTTP服务<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --zone=public --add-service=http</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<p>创建nginx用户<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd nginx</div><div class="line">passwd</div></pre></td></tr></table></figure></p>
<p>启动nginx<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/nginx/sbin/nginx</div></pre></td></tr></table></figure></p>
<p>查看端口<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -tnlp|grep nginx</div></pre></td></tr></table></figure></p>
<p><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-6.png" alt=""></p>
<p>浏览器访问<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-7.png" alt=""></p>
<p>其他命令<br>Nginx -s stop         快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。（quick exit）<br>Nginx -s quit         平稳关闭Nginx，保存相关信息，有安排的结束web服务。（graceful exit）<br>Nginx -s reload       因改变了Nginx相关配置，需要重新加载配置而重载。（changing configuration，start a new worker,quitting an old worker gracefully.)<br>Nginx -s reopen       重新打开日志文件。(reopenging log files)</p>
<h2 id="fastdfs-nginx-module-配置"><a href="#fastdfs-nginx-module-配置" class="headerlink" title="fastdfs-nginx-module 配置"></a>fastdfs-nginx-module 配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp /opt/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/</div><div class="line">touch /home/fastdfs/logs/mod_fastdfs.log</div><div class="line">chown nginx:nginx /home/fastdfs/logs/mod_fastdfs.log</div><div class="line">vi /etc/fdfs/mod_fastdfs.conf</div></pre></td></tr></table></figure>
<p>修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">base_path=/home/fastdfs</div><div class="line">tracker_server=192.168.0.80:22122</div><div class="line">store_path0=/home/fastdfs</div><div class="line">log_filename=/home/fastdfs/logs/mod_fastdfs.log</div></pre></td></tr></table></figure></p>
<p>##<br>Storage服务器Nginx配置<br>/usr/local/nginx/conf/nginx.conf 上server{} 里添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">location ~/group1/M00 &#123;</div><div class="line">    alias /home/fastdfs/data;</div><div class="line">    ngx_fastdfs_module;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Nginx重新加载配置<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/nginx/sbin/nginx <span class="_">-s</span> reload</div></pre></td></tr></table></figure></p>
<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><p>1、当上传文件时发现总是失败返回response status 2 !=0，查看storaged.log发现如下错误：<br><img src="http://7xnocv.com1.z0.glb.clouddn.com/fastdfs-install-5.png" alt=""><br>用fdfs_monitor命令查看storage节点状态<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</div></pre></td></tr></table></figure></p>
<p>发现两个离线状态的无效storage节点，用以下命令删除之<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fdfs_monitor /etc/fdfs/client.conf delete group1 192.168.0.80</div></pre></td></tr></table></figure></p>
<p>重启tracker及storage服务，问题解决。<br>未深入分析原因。</p>
<p>2、访问图片出现400错误<br>查看日志/home/fastdfs/logs/mod_fastdfs.log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[2015-07-30 16:24:13] ERROR - file: ../common/fdfs_global.c, line: 52, the format of filename &quot;group1/M00/00/00/wKgAUFW53n-AZ5X2AABzaUPC-FA370.jpg&quot; is invalid</div></pre></td></tr></table></figure></p>
<p>/opt/nginx/logs/error.log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">192.168.0.170 - - [30/Jul/2015:16:13:06 +0800] &quot;GET /group1/M00/00/00/wKgAUFW5w4iAViuiAABVNkmGVeE577.xml HTTP/1.1&quot; 400 575 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36&quot;</div></pre></td></tr></table></figure></p>
<p>后查明是因为url中带了group名字，FastDFS是默认关闭的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url_have_group_name=false</div></pre></td></tr></table></figure></p>
<p>将以上参数改为true即可<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'s:url_have_group_name.*:url_have_group_name=true:g'</span> /etc/fdfs/mod_fastdfs.conf</div></pre></td></tr></table></figure></p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>

          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

